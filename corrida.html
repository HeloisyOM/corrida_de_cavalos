<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Corrida de Cavalos</title>
</head>

<body id="body-corrida">
    <header>

        <button class="btn_header" onclick="irHome()">
            <img src="./assets/icon_home.png" alt="Icon de Home">
        </button>
    </header>
    <div class="container" id="div_iniciar_corrida">

        <div id="div_imgPlaca">
            <img id="img_placaComecar" src="assets/placas/placa_comecar.png" alt="">
        </div>
        <div class="config" id="nomeCavalos">
            <div class="info">
                <p id="digiteNome">
                    Digite o nome do 1° cavalo:
                </p>
                <input type="text" id="input_nomeCavalo" placeholder="Nome">
                <br>
                <p id="escolherSkinFrase">
                    Escolha a skin do seu cavalo:
                </p>
                <div class="escolherSkin" id="escolherSkin">
                    <button onclick="voltar()">◀</button>
                    <img id="skin" src="./assets/cavalos/cavalo1.png" alt="">
                    <button onclick="avançar()">▶</button>
                </div>

                <button class="btnCad" onclick="adicionar()" id="botaoSkin">Adicionar cavalo</button>
                <button class="btnCad" onclick="avançarConfig()" id="botaoAvançarGame">Avançar</button>
            </div>
        </div>
        <div class="config" id="qtdVoltasCorrida">
            <div class="info" id="voltas">
                <p id="digiteVoltas">
                    Digite a quantidade de voltas:
                </p>
                <input type="number" id="input_qtd_voltas" onkeydown="return false" value="0">
                <br>
                <button class="btnCad" onclick="iniciar()" id="iniciarTurfe">Iniciar turfe</button>
                <button class="btnCad" onclick="voltarConfig()" id="voltarGame">Voltar</button> <br>

            </div>
            <div id="tempos">
                <div id="conteudo_tempos">
                    <div id="div_msg"></div>
                    <div class="podio-botoes">
                        <button onclick="novaCorrida()">
                            <p>Nova corrida</p>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!-- podio -->
    <div class="container container-podio" id="div_exibir_podio">
        <div class="podio-topo">
            <div class="vazio"><span></span></div>
            <div class="podio-placa">
                <div class="placa">
                    <h2>VENCEDOR:</h2>
                    <h3 id="p_nome_vencedor"></h3>
                </div>
            </div>
            <div class="podio-botoes">
                <button onclick="novaCorrida()">
                    <p>Nova corrida</p>
                </button>
                <button onclick="exibirVoltas()">
                    <p>Tempos</p>
                </button>
            </div>
        </div>
        <div class="podio-area">
            <div class="vazio"></div>
            <div class="podio-posicoes">
                <div class="podios" id="podio-1">
                    <img id="img_cavalo_1" alt="">
                    <div class="caixote" id="caixote2">
                        <p>2</p>
                    </div>
                </div>
                <div class="podios" id="podio-0">
                    <img id="img_cavalo_0" alt="">
                    <div class="caixote" id="caixote1">
                        <p>1</p>
                    </div>
                </div>
                <div class="podios" id="podio-2">
                    <img id="img_cavalo_2" alt="">
                    <div class="caixote" id="caixote3">
                        <p>3</p>
                    </div>
                </div>
            </div>
            <div class="podio-tempo">
                <div class="melhorTempo">
                    <p>Melhor Tempo:</p>
                    <p id="p_tempo_vencedor">20.30%</p>
                </div>
            </div>
        </div>
        <img src="" alt="">
    </div>
</body>

</html>

<script>

    var listaCavalos = [];   // nome dos cavalos 
    var tempoTotal = [];     // Tempo total dos cavalos
    var listaVoltas = [];   // Tempo dos cavalos em cada volta
    var listaTempoTresPrimeiros = [];
    var listaIndiceTresPrimeiros = [];
    var skinEscolhida = []
    var cont = 0
    var qtdCavalos = 0
    var skins = ['./assets/cavalos/cavalo1.png',
        './assets/cavalos/cavalo2.png',
        './assets/cavalos/cavalo3.png',
        './assets/cavalos/cavalo4.png',
        './assets/cavalos/cavalo5.png',
        './assets/cavalos/cavalo6.png',
        './assets/cavalos/cavalo7.png',
        './assets/cavalos/cavalo8.png',
        './assets/cavalos/cavalo9.png',
        './assets/cavalos/cavalo10.png'
    ]

    function avançar() {
        cont++;
        if (cont >= skins.length) {
            cont = 0;
        }
        document.getElementById("skin").src = skins[cont];
    }
    function voltar() {
        cont--;
        if (cont < 0) {
            cont = skins.length - 1;
        }
        document.getElementById("skin").src = skins[cont];
    }

    function adicionar() {
        var textoTela = document.getElementById(`digiteNome`)
        var nomeCavalo = input_nomeCavalo.value
        if (nomeCavalo.trim()) {
            listaCavalos.push(nomeCavalo)
            document.getElementById("input_nomeCavalo").value = "";
            qtdCavalos++
            textoTela.innerHTML = `Digite o nome do ${qtdCavalos + 1}° cavalo`
            skinEscolhida.push(skins[cont])
            if (qtdCavalos >= 2) {
                botaoAvançarGame.style.display = 'block'
            }
            if (qtdCavalos == 6) {
                avançarConfig()
            }
        }
    }

    function avançarConfig() {
        nomeCavalos.style.display = 'none'
        qtdVoltasCorrida.style.display = 'flex'
    }

    function voltarConfig() {
        nomeCavalos.style.display = 'flex'
        qtdVoltasCorrida.style.display = 'none'
    }
    function iniciar() {
        tempos.style.display = 'block';
        voltas.style.display = 'none';
        var qtdCavalosOficial = qtdCavalos
        var qtdVoltas = Number(input_qtd_voltas.value)
        var mensagem = '';

        if (qtdCavalosOficial < 2 || qtdCavalosOficial > 6) {
            alert('A quantidade de cavalos deve estar entre 2 e 6');
        } else if (qtdVoltas < 2 || qtdVoltas > 10) {
            alert('A quantidade de voltas deve estar entre 2 e 10');
        } else {



            for (var cont = 0; cont < qtdVoltas; cont++) {
                // Mostra qual volta está na corrida
                var volta = cont + 1;

                // msg mostrando em qual volta esta
                mensagem += `<br>Volta:${volta} <br>`;

                // adiciona um vetor para a volta atual
                listaVoltas[cont] = []

                for (var j = 0; j < listaCavalos.length; j++) {
                    // gera um numero aleatório
                    var tempo = Number((Math.random() * 2 + 7).toFixed(1));

                    // coloca o tempo do cavalo em uma lista com todos os tempos
                    listaVoltas[cont][j] = tempo;

                    // Soma o tempo total do cavalo
                    // valida se existe já existe o tempo
                    if (tempoTotal[j]) {
                        tempoTotal[j] += tempo; // se tiver concatena
                    } else {
                        tempoTotal.push(tempo); // senão add o tempo
                    }

                    // nome do cavalo  - Tempo da volta  - Tempo total do cavalo 
                    mensagem += `    
                    ${listaCavalos[j]} - Tempo: ${tempo} - Tempo total: ${tempoTotal[j].toFixed(1)}<br>`;
                    // aqui que está errado, nome do cavalo
                }


            }


            // função Podio
            var tempoPrimeiro = 1000;
            var indicePrimeiro = 0;
            for (var i = 0; i < tempoTotal.length; i++) {
                var tempo = tempoTotal[i]
                if (tempo < tempoPrimeiro) {
                    tempoPrimeiro = tempo;
                    indicePrimeiro = i;
                }
            }
            var tempoSegundo = 1000;
            var indiceSegundo = 0;
            for (var i = 0; i < tempoTotal.length; i++) {
                var tempo = tempoTotal[i];
                if (tempo < tempoSegundo && i != indicePrimeiro) {
                    tempoSegundo = tempo;
                    indiceSegundo = i;
                }
            }
            if (qtdCavalos > 2) {

            }
            var tempoTerceiro = 1000;
            var indiceTerceiro = 0;
            for (var i = 0; i < tempoTotal.length; i++) {
                var tempo = tempoTotal[i]
                if (tempo < tempoTerceiro && (i != indicePrimeiro && i != indiceSegundo)) {
                    tempoTerceiro = tempo;
                    indiceTerceiro = i;
                }
            }
            if (qtdCavalos > 2) {
                listaIndiceTresPrimeiros.push(indicePrimeiro, indiceSegundo, indiceTerceiro);
                listaTempoTresPrimeiros.push(tempoPrimeiro, tempoSegundo, tempoTerceiro);
            } else {
                listaIndiceTresPrimeiros.push(indicePrimeiro, indiceSegundo);
                listaTempoTresPrimeiros.push(tempoPrimeiro, tempoSegundo);
            }
            div_msg.innerHTML = mensagem;

            setTimeout(() => {
                div_iniciar_corrida.style.display = 'none'
                div_imgPlaca.style.display = 'none';

                exibirPodio()
            }, 2000)

        }
    }
    function exibirPodio() {
        div_iniciar_corrida.style.display = 'none'
        div_exibir_podio.style.display = 'block'


        for (var i = 0; i < listaIndiceTresPrimeiros.length; i++) {
            var lugarPodio = document.getElementById(`podio-${i}`)
            var cavaloPodio = document.getElementById(`img_cavalo_${i}`)
            var indice = listaIndiceTresPrimeiros[i];
            var cavalo = listaCavalos[indice];
            var tempo = listaTempoTresPrimeiros[i];
            lugarPodio.style.display = 'flex'
            cavaloPodio.src = `${skinEscolhida[indice]}`
        }
        var cavaloVencedor = document.getElementById(`p_nome_vencedor`)
        cavaloVencedor.innerHTML = listaCavalos[listaIndiceTresPrimeiros[0]]
        var melhorTempo = document.getElementById('p_tempo_vencedor')
        melhorTempo.innerHTML = listaTempoTresPrimeiros[0].toFixed(2)
        console.log(tempoTotal);
    }


    function novaCorrida() {
        // limpa os valores já salvos caso exista
        listaCavalos = [];   // nome dos cavalos 
        tempoTotal = [];     // Tempo total dos cavalos
        listaVoltas = [];   // Tempo dos cavalos em cada volta
        listaTempoTresPrimeiros = [];
        listaIndiceTresPrimeiros = [];
        skinEscolhida = []
        cont = 0
        qtdCavalos = 0

        // limpado os input
        input_nomeCavalo.value = ''
        input_qtd_voltas.value = ''
        div_msg.innerHTML = ''

        digiteNome.innerHTML = `Digite o nome do ${qtdCavalos + 1}° cavalo`


        // garantindo que a tela exista
        div_iniciar_corrida.style.display = 'block'
        div_exibir_podio.style.display = 'none'
        nomeCavalos.style.display = 'flex'
        qtdVoltasCorrida.style.display = 'none'
        div_imgPlaca.style.display = 'block';

    }

    function exibirVoltas() {
        div_iniciar_corrida.style.display = 'block'
        div_exibir_podio.style.display = 'none'
        div_imgPlaca.style.display = 'none';
    }

    function irHome() {
        window.location = 'index.html'

    }
</script>